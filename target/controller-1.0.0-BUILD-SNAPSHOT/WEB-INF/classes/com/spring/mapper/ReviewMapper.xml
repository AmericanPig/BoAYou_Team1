<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.spring.mapper.ReviewMapper">
  
<!-- 특정 docid 특정 user_id 리뷰 있는지 확인 select -->
	<select id= "selectReviewCnt" resultType="Integer">
		select count(*) from review where docid=#{docid} and user_id= #{user_id}
	</select>

<!-- 리뷰출력 select -->
	<select id= "selectReviewById" resultType="com.spring.domain.ReviewDTO">
		select * from review where docid=#{docid} and user_id= #{user_id}
	</select>
	
<!-- 리뷰달기 insert -->
	<insert id="insertReviewById">
		insert into review (user_id, docid, review_star, review_content)
			values (#{user_id}, #{docid}, #{review_star}, #{review_content})
	</insert>

<!-- 리뷰수정 update -->
	<update id="updateReviewById">
		update review set review_star=#{review_star}, review_content=#{review_content}
			where review_no= #{review_no} and user_id= #{user_id}
	</update>

<!-- 리뷰삭제 delete -->
	<delete id="deleteReviewById">
		delete from review where review_no= #{review_no}
	</delete>

<!-- 마이페이지 내 전체리뷰 목록 select -->
	<select id="selectUserReviewList" resultType="com.spring.domain.ReviewDTO">
		select * from review where user_id=#{user_id}
	</select>


<!-- 영화상세페이지 해당 영화 전체리뷰 목록 select -->
	<select id="selectMovieReviewList" resultType="com.spring.domain.ReviewDTO">
		select * from review where docid= #{docid}
	</select>

<!-- 영화상세페이지 전체리뷰 평점 평균 select -->
	<select id="selectReviewStarAvg" resultType="double">
		select avg(review_star) as StarScore from review where docid= #{docid}
	</select>
	</mapper>